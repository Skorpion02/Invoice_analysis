# Invoice Analysis

This repository contains a detailed analysis of an invoice dataset using the powerful Python library `pandas` for data analysis.

## Project Objective

The main goal of this project is to perform a comprehensive analysis of an invoice dataset. Through this analysis, the aim is to:

* **Clean and transform data:** Acquire and apply techniques to prepare data for analysis, including managing formats, null values, and special characters.
* **Create synthetic columns:** Generate new features from existing data to enrich the analysis and gain deeper insights.
* **Group, combine, and filter data:** Utilize key Pandas functions like `groupby()`, `merge()`, and filtering operations to explore relationships and patterns within the dataset.
* **Perform temporal analysis:** Extract information based on time patterns, such as sales by month, year, or time slot.
* **Generate advanced visualizations:** Create charts and heatmaps to effectively interpret and communicate analysis results.

## Questions and Activities for Invoice Analysis

The analysis is structured around a series of questions and activities, covering different aspects of the invoice dataset.

### 1. Initial Data Exploration and Transformation

* **Load the dataset:** Instructions on how to load the CSV file containing invoices into a Pandas DataFrame.
* **Explore the data:** Visualization of the first few rows of the dataset for initial data understanding.
* **Data types:** Checking the data types of each column in the DataFrame.
* **'Monto' (Amount) column conversion:** Demonstrating how to remove commas (if any) and convert the 'Monto' column to a `float` type.
* **Date conversion:** Explaining the importance of converting the 'Fecha de factura' (Invoice Date) column to `datetime` type and how to do it.

### 2. Creation of New Synthetic Columns

* **Year, month, and day of the week:** Creating new columns for the year, month, and day of the week from 'Fecha de factura'.
* **Purchase hour:** Extracting the purchase hour from the 'Fecha de factura' column.
* **Time slot:** Creating a new column called 'Franja Horaria' (Time Slot) using conditionals to classify hours into Morning, Afternoon, Evening, and Dawn, and explaining which Pandas function would be used for this classification.

### 3. Analysis by Customer and Country

* **Grouping by customer:** Grouping data by 'ID Cliente' (Customer ID) to calculate:
    * Total products purchased.
    * Total amount spent by each customer.
    * Number of invoices.
    * Identification of the customer who spent the most.
* **Grouping by country:** Grouping sales by 'País' (Country) to analyze the total amount sold and the number of invoices in each country.
* **VIP customers:** Identifying customers who have spent more than 5000 and can therefore be considered VIP customers. A new 'VIP' column (`True`/`False`) is created, and only VIP customers are shown in the final result.

### 4. Temporal Analysis

* **Sales by semester:** Dividing sales into two semesters, creating a new 'Semestre' (Semester) column, and determining which semester has more sales.
* **Sales by time slot and country:** Grouping data by 'País' (Country) and 'Franja Horaria' (Time Slot) to analyze sales, identifying which country sells the most in the morning and at night.

### 5. Filtering Weekend Data

* **5.A Analysis of the 20 most important customers:**
    * Identification of the 20 customers who purchased the most products and generated the most sales during the weekend.
    * Calculation of the number of invoices generated by these 20 customers during the weekend.
* **5.B Grouping by semester:**
    * Analysis of the distribution of total sales, quantity of products sold, and number of invoices issued in each semester of the year.
    * Determination of the sales trend across semesters.

### 6. Comprehensive Billing Analysis by Country, Customer, and Products

* **Group data by country and customer:** Calculate the total quantity and amount invoiced by each customer in each country.
* **Top five customers by invoiced amount:** Identify the five customers with the highest invoiced amount in each country.
* **Country with the highest total invoiced amount and average per customer:** Identify the country with the highest total invoiced amount across all customers and calculate the average invoiced amount per customer in that country.
* **Order customers by total invoiced quantity and correlation:** Order customers in each country by total invoiced quantity and show the 3 customers with the highest quantities per country. Additionally, calculate the correlation between quantity and invoiced amount for each country and display these values.
* **Segment invoiced amount into quartiles per country:** For each country, divide the total invoiced amount by customer into four groups using the `pd.cut` function to segment them into quartiles. Count how many customers belong to each group in each country.
* **New column for total invoiced per customer and handling negative values:** Create a new column indicating the total amount invoiced by each customer across all their purchases and replace any negative values in the 'Monto' (Amount) column with the average amount of the entire database.

### 7. Customer Segmentation and Purchase Behavior Analysis

* **Total invoiced per customer and transformation:** Calculate the total amount invoiced by each customer in each country and create a new 'Total Facturado' (Total Invoiced) column that aggregates this information. Then, perform a transformation using the `transform` function to calculate the total invoiced per customer and add this new column to the original DataFrame.
* **Customer classification by total invoiced amount:** Use `pd.cut` to classify customers into 4 segments based on their total invoiced amount: low, medium-low, medium-high, and high. Count how many customers exist in each segment for each country.
* **Contingency table (crosstab):** Create a contingency table using `crosstab` to show the relationship between the customer segment (based on their total invoiced amount) and the country they are in. Identify which country has the most customers in the high segment.
* **Correlation between quantity purchased and invoiced amount per country:** Calculate the correlation between 'Cantidad' (Quantity) purchased and 'Monto' (Amount) invoiced for each country. Determine if there are differences in the correlation between countries.
* **Top 5 customers by invoicing:** Identify the 5 customers with the highest invoicing in the dataset using `nlargest` and display the corresponding invoice and country for each of them.
* **Total invoiced by month for each customer (unstack):** Use the `unstack` function to transform the DataFrame and view the total invoiced by month for each customer. Ensure a new column is added for the month of each invoice.

### 8. Comprehensive Invoicing Analysis and Data Transformation

* **New column for total invoiced by customer (transform):** Create a new column indicating the total amount invoiced by each customer across all invoices. Use the `transform` command to add this column to each corresponding row for each customer.
* **Sort DataFrame by country and invoicing amount:** Sort the DataFrame by country and invoicing amount in descending order. Display the first 5 records.
* **Replace negative 'Monto' values based on total customer invoicing:** For customers whose total invoicing amount is greater than the average total amount per country, replace negative values in the 'Monto' column with the average value of the 'Monto' column for the entire database.
* **Reorganize DataFrame with stack and unstack:** Use the `stack` function to reorganize the DataFrame into a stacked form to view the relationships between the customer and the invoice amount. Then, use `unstack` to display the same information but with customers as columns.
* **Comparison of total sales by country and customer, and correlation analysis:** Perform a comparison of total sales by country and by customer using `groupby`, then calculate the average sales per country. Next, conduct a correlation analysis between the invoice amount and the quantity purchased per country.
* **Percentage of invoicing per country:** Calculate the percentage of invoicing for each country relative to the total invoiced. Transform the result into a percentage.
* **Top 3 invoices with highest amounts:** Identify the 3 invoices with the highest amounts and display the country they belong to. Determine if there is any pattern in the countries with higher invoices.

---

## Repository Structure

.
├── Invoice_analysis.py
├── README.md
└── data/
└── ventas-por-factura.csv (This file should be added manually if it doesn't exist)

---

## How to Use

1.  **Clone the repository:**
    ```bash
    git clone [https://github.com/your-username/Invoice-Analysis.git](https://github.com/your-username/Invoice-Analysis.git)
    cd Invoice-Analysis
    ```
2.  **Create the `data` directory and place the CSV file:**
    Ensure you have the `ventas-por-factura.csv` file inside the `data/` folder. If you don't have the file, you can create it manually or adapt the path to where you store it.
3.  **Install dependencies:**
    ```bash
    pip install pandas unidecode
    ```
4.  **Run the analysis script:**
    You can execute the `Invoice_analysis.py` script directly:
    ```bash
    python Invoice_analysis.py
    ```
    Or, for an interactive experience, you can open it in an environment like Jupyter Notebook or Spyder and run the cells step-by-step to see the results of each section.

---
